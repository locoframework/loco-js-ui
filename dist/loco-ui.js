!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.LocoUI=e():t.LocoUI=e()}(window,(function(){return function(t){var e={};function r(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,r),s.l=!0,s.exports}return r.m=t,r.c=e,r.d=function(t,e,i){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)r.d(i,s,function(e){return t[e]}.bind(null,s));return i},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=0)}([function(t,e,r){"use strict";r.r(e);var i={Env:null,I18n:null,Utils:null},s={Form:function(){function t(t){null==t&&(t={}),this.formId=t.id,this.obj=t.for,this.initObj=!(null==t.initObj||!t.initObj),this.delegator=t.delegator,this.callbackSuccess=t.callbackSuccess,this.callbackFailure=t.callbackFailure,this.callbackActive=t.callbackActive,this.form=this._findForm(),this.submit=null,this.submitVal=null,null!=this.form&&(this.submit=this.form.querySelector('[type="submit"]')),null!=this.submit&&(this.submitVal=this.submit.value),this.locale=i.Env.loco.getLocale()}return t.prototype.getObj=function(){return this.obj},t.prototype.render=function(){return this.initObj?(this._assignAttribs(),this._handle()):null!=this.form?(this.fill(),this._handle()):void 0},t.prototype.fill=function(t){var e,r,s,n,l,o,u,a;if(null==t&&(t=null),null==this.obj)return null;if(null==this.obj.constructor.attributes)return null;for(s in e={},null!=t?e[t]=null:e=this.obj.constructor.attributes,u=[],e)e[s],o=this.obj.getAttrRemoteName(s),null!==(n=this.form.querySelector("[data-attr="+o+"]"))&&0!==(r=n.querySelectorAll("input,textarea,select")).length&&(1!==r.length?1!==(a=i.Utils.Array.uniq(i.Utils.Array.map(r,(function(t){return t.getAttribute("type")})))).length||"radio"!==a[0]||null==(l=i.Utils.Collection.find(r,function(t){return function(e){return e.value===String(t.obj[s])}}(this)))?"hidden"!==r[0].getAttribute("type")&&"checkbox"!==r[r.length-1].getAttribute("type")||u.push(r[r.length-1].checked=Boolean(this.obj[s])):l.checked=!0:r[0].value=this.obj[s]);return u},t.prototype._findForm=function(){var t;return null!=this.formId?document.getElementById(""+this.formId):null!=this.obj?(t=this.obj.getIdentity().toLowerCase(),null!=this.obj.id?document.getElementById("edit_"+t+"_"+this.obj.id):document.getElementById("new_"+t)):void 0},t.prototype._handle=function(){return this.form.addEventListener("submit",(t=this,function(e){var r;if(e.preventDefault(),t._canBeSubmitted()){if(null!=t.obj)return t._assignAttribs(),t._hideErrors(),t.obj.isInvalid()?(t._renderErrors(),void(null!=t.callbackFailure&&t.delegator[t.callbackFailure]())):(t._submittingForm(!1),r=null==t.obj.id,t.obj.save().then((function(e){return t._alwaysAfterRequest(),e.success?t._handleSuccess(e,r):(null!=t.callbackFailure&&t.delegator[t.callbackFailure](),t._renderErrors())})).catch((function(e){return t._connectionError()})));t._submitForm()}}));var t},t.prototype._canBeSubmitted=function(){return null==this.submit||!i.Utils.Dom.hasClass(this.submit,"active")&&(!i.Utils.Dom.hasClass(this.submit,"success")&&!i.Utils.Dom.hasClass(this.submit,"failure"))},t.prototype._submitForm=function(){var t,e,r,i,s;return this._submittingForm(),i=this.form.getAttribute("action")+".json",t=new FormData(this.form),(r=new XMLHttpRequest).open("POST",i),r.setRequestHeader("X-CSRF-Token",null!=(e=document.querySelector("meta[name='csrf-token']"))?e.content:void 0),r.onload=(s=this,function(e){return s._alwaysAfterRequest(),null!=s.submit&&s.submit.blur(),e.target.status>=200&&e.target.status<400?(t=JSON.parse(e.target.response)).success?s._handleSuccess(t,"POST"===s.form.getAttribute("method")):s._renderErrors(t.errors):e.target.status>=500?s._connectionError():void 0}),r.onerror=function(t){return function(){return t._alwaysAfterRequest(),null!=t.submit&&t.submit.blur(),t._connectionError()}}(this),r.send(t)},t.prototype._handleSuccess=function(t,e){var r,s,n,l;if(null==e&&(e=!0),n=null!=(r=null!=(s=t.flash)?s.success:void 0)?r:i.I18n[this.locale].ui.form.success,null!=this.submit&&(i.Utils.Dom.addClass(this.submit,"success"),this.submit.value=n),null!=t.access_token&&i.Env.loco.getWire().setToken(t.access_token),null==this.callbackSuccess)return setTimeout((l=this,function(){var t,r,s,n,o,u;if(null!=l.submit&&(l.submit.disabled=!1,i.Utils.Dom.removeClass(l.submit,"success"),l.submit.value=l.submitVal),u=":not([data-loco-not-clear=true])",e){for(o=[],t=0,r=(n=l.form.querySelectorAll("input:not([type='submit'])"+u+", textarea"+u)).length;t<r;t++)s=n[t],o.push(s.value="");return o}}),5e3);null!=t.data?this.delegator[this.callbackSuccess](t.data):this.delegator[this.callbackSuccess]()},t.prototype._renderErrors=function(t){var e,r,s,n,l,o,u,a,c;if(null==t&&(t=null),!(null!=this.obj&&null==this.obj.errors||null==this.obj&&null==t)){for(e in r=null!=t?t:this.obj.errors)if(s=r[e],null==(c=null!=this.obj?this.obj.getAttrRemoteName(e):e)||"base"===e)"base"===e&&s.length>0&&(1===(u=document.querySelectorAll(".errors[data-for='base']")).length?u[0].textContent=s[0]:null!=this.submit&&(this.submit.value=s[0]));else{if(null===(a=this.form.querySelector("[data-attr="+c+"]")))continue;if(0===(u=a.querySelectorAll(".errors[data-for="+c+"]")).length)continue;for(n=0,l=u.length;n<l;n++)(o=u[n]).textContent=s[0]}return null!=this.submit&&(this.submit.value!==this.submitVal&&this.submit.value!==i.I18n[this.locale].ui.form.sending||(this.submit.value=i.I18n[this.locale].ui.form.errors.invalid_data),i.Utils.Dom.addClass(this.submit,"failure")),this._showErrors(),setTimeout((h=this,function(){var t,e,r,s;for(null!=h.submit&&(h.submit.disabled=!1,i.Utils.Dom.removeClass(h.submit,"failure"),h.submit.value=h.submitVal),s=[],t=0,e=(r=h.form.querySelectorAll("input.invalid, textarea.invalid, select.invalid")).length;t<e;t++)o=r[t],s.push(i.Utils.Dom.removeClass(o,"invalid"));return s}),1e3);var h}},t.prototype._assignAttribs=function(){var t,e,r,s,n,l,o,u;if(null==this.obj.constructor.attributes)return null;for(e in o=[],n=this.obj.constructor.attributes)n[e],l=this.obj.getAttrRemoteName(e),null!==(r=this.form.querySelector("[data-attr="+l+"]"))&&0!==(t=r.querySelectorAll("input,textarea,select")).length&&(1!==t.length?1!==(u=i.Utils.Array.uniq(i.Utils.Array.map(t,(function(t){return t.getAttribute("type")})))).length||"radio"!==u[0]||null==(s=i.Utils.Collection.find(t,(function(t){return!0===t.checked})))?"hidden"!==t[0].getAttribute("type")&&"checkbox"!==t[t.length-1].getAttribute("type")||(!0===t[t.length-1].checked?o.push(this.obj.assignAttr(e,t[t.length-1].value)):o.push(this.obj.assignAttr(e,t[0].value))):this.obj.assignAttr(e,s.value):this.obj.assignAttr(e,t[0].value));return o},t.prototype._hideErrors=function(){var t,e,r,i,s;for(s=[],e=0,r=(i=this.form.querySelectorAll(".errors")).length;e<r;e++)(t=i[e]).textContent.trim().length>0?(t.textContent="",s.push(t.style.display="none")):s.push(void 0);return s},t.prototype._showErrors=function(){var t,e,r,i,s;for(s=[],e=0,r=(i=this.form.querySelectorAll(".errors")).length;e<r;e++)(t=i[e]).textContent.trim().length>0?s.push(t.style.display="block"):s.push(void 0);return s},t.prototype._submittingForm=function(t){if(null==t&&(t=!0),null!=this.submit&&(i.Utils.Dom.removeClass(this.submit,"success"),i.Utils.Dom.removeClass(this.submit,"failure"),i.Utils.Dom.addClass(this.submit,"active"),this.submit.value=i.I18n[this.locale].ui.form.sending),null!=this.callbackActive&&this.delegator[this.callbackActive](),t)return this._hideErrors()},t.prototype._connectionError=function(){var t;if(null!=this.submit)return i.Utils.Dom.removeClass(this.submit,"active"),i.Utils.Dom.addClass(this.submit,"failure"),this.submit.value=i.I18n[this.locale].ui.form.errors.connection,setTimeout((t=this,function(){return t.submit.disabled=!1,i.Utils.Dom.removeClass(t.submit,"failure"),t.submit.value=t.submitVal}),3e3)},t.prototype._alwaysAfterRequest=function(){if(null!=this.submit)return i.Utils.Dom.removeClass(this.submit,"active")},t}()};r.d(e,"Deps",(function(){return i})),r.d(e,"UI",(function(){return s}))}])}));