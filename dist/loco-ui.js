!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.LocoUI=e():t.LocoUI=e()}(self,(()=>(()=>{"use strict";var t={d:(e,r)=>{for(var n in r)t.o(r,n)&&!t.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:r[n]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};t.r(e),t.d(e,{UI:()=>u,connect:()=>f});const r={getLocale:null,wire:null,I18n:null};var n=function(t,e){return null!=t.classList?t.classList.contains(e):new RegExp("(^| )"+e+"( |$)","gi").test(t.className)},i=function(t,e){null!=t.classList?t.classList.add(e):t.className+=" "+e},o=function(t,e){null!=t.classList?t.classList.remove(e):t.className=t.className.replace(new RegExp("(^|\\b)"+e.split(" ").join("|")+"(\\b|$)","gi")," ")},s=function(t){return Array.from(t).map((function(t){return t.getAttribute("type")})).filter((function(t,e,r){return r.indexOf(t)===e}))};const u={Form:function(){function t(t){null==t&&(t={}),this.formId=t.id,this.obj=t.for,this.initObj=!(null==t.initObj||!t.initObj),this.callbackSuccess=t.callbackSuccess,this.callbackFailure=t.callbackFailure,this.callbackActive=t.callbackActive,this.form=this._findForm(),this.submit=null,this.submitVal=null,null!=this.form&&(this.submit=this.form.querySelector('[type="submit"]')),null!=this.submit&&(this.submitVal=this.submit.value),this.locale=r.getLocale()}return t.prototype.getObj=function(){return this.obj},t.prototype.render=function(){return this.initObj?(this._assignAttribs(),this._handle()):null!=this.form?(this.fill(),this._handle()):void 0},t.prototype.fill=function(t){var e,r,n,i,o,u,l,c;if(null==t&&(t=null),null==this.obj)return null;if(null==this.obj.constructor.attributes)return null;for(n in e={},null!=t?e[t]=null:e=this.obj.constructor.attributes,l=[],e)e[n],u=this.obj.getAttrRemoteName(n),null!==(i=this.form.querySelector("[data-attr="+u+"]"))&&0!==(r=i.querySelectorAll("input,textarea,select")).length&&(1!==r.length?1!==(c=s(r)).length||"radio"!==c[0]||null==(o=Array.from(r).find(function(t){return function(e){return e.value===String(t.obj[n])}}(this)))?"hidden"!==r[0].getAttribute("type")&&"checkbox"!==r[r.length-1].getAttribute("type")||l.push(r[r.length-1].checked=Boolean(this.obj[n])):o.checked=!0:r[0].value=this.obj[n]);return l},t.prototype._findForm=function(){var t;return null!=this.formId?document.getElementById(""+this.formId):null!=this.obj?(t=this.obj.getIdentity().toLowerCase(),null!=this.obj.id?document.getElementById("edit_"+t+"_"+this.obj.id):document.getElementById("new_"+t)):void 0},t.prototype._handle=function(){return this.form.addEventListener("submit",(t=this,function(e){var r;if(e.preventDefault(),t._canBeSubmitted()){if(null!=t.obj)return t._assignAttribs(),t._hideErrors(),t.obj.isInvalid()?(t._renderErrors(),void(null!=t.callbackFailure&&t.callbackFailure())):(t._submittingForm(!1),r=null==t.obj.id,t.obj.save().then((function(e){return t._alwaysAfterRequest(),e.success?t._handleSuccess(e,r):(null!=t.callbackFailure&&t.callbackFailure(),t._renderErrors())})).catch((function(e){return t._connectionError()})));t._submitForm()}}));var t},t.prototype._canBeSubmitted=function(){return null==this.submit||!n(this.submit,"active")&&!n(this.submit,"success")&&!n(this.submit,"failure")},t.prototype._submitForm=function(){var t,e,r,n,i;return this._submittingForm(),n=this.form.getAttribute("action")+".json",t=new FormData(this.form),(r=new XMLHttpRequest).open("POST",n),r.setRequestHeader("X-CSRF-Token",null!=(e=document.querySelector("meta[name='csrf-token']"))?e.content:void 0),r.onload=(i=this,function(e){return i._alwaysAfterRequest(),null!=i.submit&&i.submit.blur(),e.target.status>=200&&e.target.status<400?(t=JSON.parse(e.target.response)).success?i._handleSuccess(t,"POST"===i.form.getAttribute("method")):i._renderErrors(t.errors):e.target.status>=500?i._connectionError():void 0}),r.onerror=function(t){return function(){return t._alwaysAfterRequest(),null!=t.submit&&t.submit.blur(),t._connectionError()}}(this),r.send(t)},t.prototype._handleSuccess=function(t,e){var n,s,u,l;if(null==e&&(e=!0),u=null!=(n=null!=(s=t.flash)?s.success:void 0)?n:r.I18n[this.locale].ui.form.success,null!=this.submit&&(i(this.submit,"success"),this.submit.value=u),null!=t.access_token&&(r.wire.token=t.access_token),null==this.callbackSuccess)return setTimeout((l=this,function(){var t,r,n,i,s,u;if(null!=l.submit&&(l.submit.disabled=!1,o(l.submit,"success"),l.submit.value=l.submitVal),u=":not([data-loco-not-clear=true])",e){for(s=[],t=0,r=(i=l.form.querySelectorAll("input:not([type='submit'])"+u+", textarea"+u)).length;t<r;t++)n=i[t],s.push(n.value="");return s}}),5e3);null!=t.data?this.callbackSuccess(t.data):this.callbackSuccess()},t.prototype._renderErrors=function(t){var e,n,s,u,l,c,a,b,h;if(null==t&&(t=null),!(null!=this.obj&&null==this.obj.errors||null==this.obj&&null==t)){for(e in n=null!=t?t:this.obj.errors)if(s=n[e],null==(h=null!=this.obj?this.obj.getAttrRemoteName(e):e)||"base"===e)"base"===e&&s.length>0&&(1===(a=document.querySelectorAll(".errors[data-for='base']")).length?a[0].textContent=s[0]:null!=this.submit&&(this.submit.value=s[0]));else{if(null===(b=this.form.querySelector("[data-attr="+h+"]")))continue;if(0===(a=b.querySelectorAll(".errors[data-for="+h+"]")).length)continue;for(u=0,l=a.length;u<l;u++)(c=a[u]).textContent=s[0]}return null!=this.submit&&(this.submit.value!==this.submitVal&&this.submit.value!==r.I18n[this.locale].ui.form.sending||(this.submit.value=r.I18n[this.locale].ui.form.errors.invalid_data),i(this.submit,"failure")),this._showErrors(),setTimeout((f=this,function(){var t,e,r,n;for(null!=f.submit&&(f.submit.disabled=!1,o(f.submit,"failure"),f.submit.value=f.submitVal),n=[],t=0,e=(r=f.form.querySelectorAll("input.invalid, textarea.invalid, select.invalid")).length;t<e;t++)c=r[t],n.push(o(c,"invalid"));return n}),1e3);var f}},t.prototype._assignAttribs=function(){var t,e,r,n,i,o,u,l;if(null==this.obj.constructor.attributes)return null;for(e in u=[],i=this.obj.constructor.attributes)i[e],o=this.obj.getAttrRemoteName(e),null!==(r=this.form.querySelector("[data-attr="+o+"]"))&&0!==(t=r.querySelectorAll("input,textarea,select")).length&&(1!==t.length?1!==(l=s(t)).length||"radio"!==l[0]||null==(n=Array.from(t).find((function(t){return!0===t.checked})))?"hidden"!==t[0].getAttribute("type")&&"checkbox"!==t[t.length-1].getAttribute("type")||(!0===t[t.length-1].checked?u.push(this.obj.assignAttr(e,t[t.length-1].value)):u.push(this.obj.assignAttr(e,t[0].value))):this.obj.assignAttr(e,n.value):this.obj.assignAttr(e,t[0].value));return u},t.prototype._hideErrors=function(){var t,e,r,n,i;for(i=[],e=0,r=(n=this.form.querySelectorAll(".errors")).length;e<r;e++)(t=n[e]).textContent.trim().length>0?(t.textContent="",i.push(t.style.display="none")):i.push(void 0);return i},t.prototype._showErrors=function(){var t,e,r,n,i;for(i=[],e=0,r=(n=this.form.querySelectorAll(".errors")).length;e<r;e++)(t=n[e]).textContent.trim().length>0?i.push(t.style.display="block"):i.push(void 0);return i},t.prototype._submittingForm=function(t){if(null==t&&(t=!0),null!=this.submit&&(o(this.submit,"success"),o(this.submit,"failure"),i(this.submit,"active"),this.submit.value=r.I18n[this.locale].ui.form.sending),null!=this.callbackActive&&this.callbackActive(),t)return this._hideErrors()},t.prototype._connectionError=function(){var t;if(null!=this.submit)return o(this.submit,"active"),i(this.submit,"failure"),this.submit.value=r.I18n[this.locale].ui.form.errors.connection,setTimeout((t=this,function(){return t.submit.disabled=!1,o(t.submit,"failure"),t.submit.value=t.submitVal}),3e3)},t.prototype._alwaysAfterRequest=function(){if(null!=this.submit)return o(this.submit,"active")},t}()},l={ui:{form:{sending:"Sending...",success:"Success",errors:{connection:"Connection Error",invalid_data:"Invalid data"}}}};function c(t){return c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},c(t)}function a(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function b(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?a(Object(r),!0).forEach((function(e){h(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}function h(t,e,r){return(e=function(t){var e=function(t,e){if("object"!==c(t)||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,"string");if("object"!==c(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===c(e)?e:String(e)}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}var f=function(t){r.getLocale=t.getLocale,r.wire=t.loco.getWire(),r.I18n=t.I18n,r.I18n.en=b(b({},l),r.I18n.en)};return e})()));
//# sourceMappingURL=loco-ui.js.map